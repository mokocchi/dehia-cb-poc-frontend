(this["webpackJsonpdehia-cb-poc-frontend"]=this["webpackJsonpdehia-cb-poc-frontend"]||[]).push([[0],{187:function(e,t,r){},211:function(e,t){},213:function(e,t){},226:function(e,t){},228:function(e,t){},256:function(e,t){},257:function(e,t){},262:function(e,t){},264:function(e,t){},271:function(e,t){},290:function(e,t){},323:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(30),s=r.n(a),c=r(38),i=r(26),o=r(34),u="API_USER_FOUND";var l="API_USER_EXPIRED";var d="LOADING_API_USER";function h(){return{type:d}}var j="API_USER_LOGGED_OUT";function b(){return{type:j}}var f={name:null,isLoading:!1};var g=Object(c.b)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return Object(o.a)(Object(o.a)({},e),{},{name:t.user.name,isLoading:!1});case l:case j:return f;case d:return Object(o.a)(Object(o.a)({},f),{},{isLoading:!0});default:return e}}}),p=r(170),O=r(171),v=r(172),x=r(173),m=r(174),k="\n@font-face {\n  src: url(".concat(p.a,");\n  font-family: FontAwesome;\n}\n@font-face {\n  src: url(").concat(O.a,");\n  font-family: Entypo;\n}\n@font-face {\n    src: url(").concat(v.a,");\n    font-family: Ionicons;\n}\n@font-face {\n    src: url(").concat(x.a,");\n    font-family: MaterialIcons;\n}\n@font-face {\n  src: url(").concat(m.a,");\n  font-family: MaterialCommunityIcons;\n}\n"),S=document.createElement("style");S.type="text/css",S.styleSheet?S.styleSheet.cssText=k:S.appendChild(document.createTextNode(k)),document.head.appendChild(S);var y=r(67),w=r(11),C=r(328),R=(r(187),r(329)),B=r(325),E=r(326),T=r(1);var _=function(e){var t=e.text;return Object(T.jsxs)(R.a.Control,{as:B.a,variant:"Light",disabled:!0,children:[Object(T.jsx)(E.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),t||"Loading..."]})},U=r(9),I=r.n(U),L=r(17),z=r(22),D=r(23),A=r(32),q=r(31),N=r(52),P=r.n(N),M=r(327),G=r(175),J="https://dehia-cb-poc-gateway.herokuapp.com",F="".concat(J,"/api/v1.0"),H="".concat(J,"/login"),K=r(176),V=r.n(K);function W(e){return Date.now()>e}var X=r(330),Y=function(e){var t=e.loggedIn,r=e.logout;return Object(T.jsxs)(X.a,{className:"navbar",bg:"primary",children:[Object(T.jsxs)(X.a.Brand,{children:["Circuit Breaker PoC ",t&&"- Dashboard"]}),t&&Object(T.jsx)(B.a,{onClick:r,className:"float-right",variant:"outline-light",children:"Logout"})]})},Q=function(e){Object(A.a)(r,e);var t=Object(q.a)(r);function r(){var e;return Object(z.a)(this,r),(e=t.call(this)).pingGateway=Object(L.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:P()(J).then((function(t){200===t.status&&e.setState({loading:!1})})).catch((function(e){return console.log(e)}));case 1:case"end":return t.stop()}}),t)}))),e.state={loading:!0},e}return Object(D.a)(r,[{key:"componentDidMount",value:function(){var e=this;(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;return new Promise((function r(n){e()?n():setTimeout((function(e){return r(n)}),t)}))})((function(t){return e.pingGateway()&&!1===e.state.loading}),5e3).then((function(t){return e.setState({loading:!1})}))}},{key:"render",value:function(){return Object(T.jsxs)("div",{children:[Object(T.jsx)(Y,{loggedIn:!1}),this.state.loading?Object(T.jsx)("div",{children:Object(T.jsx)(_,{text:"Starting..."})}):Object(T.jsxs)("div",{className:"App",children:[Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsxs)("p",{children:["This is a proof of concept for the ",Object(T.jsx)("a",{href:"https://docs.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker",children:"Circuit Breaker"})," pattern. ",Object(T.jsx)("br",{}),"Log in to see the dashboard.",Object(T.jsx)("br",{}),"You have 15 minutes."]})})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsx)(y.b,{className:"loginButton",to:"/login",children:Object(T.jsx)(B.a,{variant:"outline-dark",children:"Login"})})})})]})]})}}]),r}(n.Component);function Z(e){return{auth:e.auth}}var $=function(e){return Object(i.b)(Z)((function(t){return t.auth.isLoading?Object(T.jsx)(_,{}):t.auth.name?Object(T.jsx)(e,Object(o.a)({},t)):Object(T.jsx)(Q,Object(o.a)({},t))}))},ee=function(){function e(){Object(z.a)(this,e)}return Object(D.a)(e,[{key:"setAuth",value:function(e){this.auth=e}},{key:"login",value:function(){var e=Object(L.a)(I.a.mark((function e(){var t=this;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P.a.post(H,{token:!0}).then((function(e){if(!e.error_code){if(e.data){var r={token:e.data.accessToken,expiresAt:(n=e.data.expires_in,Date.now()+n)};return t.setAuth(r),r}return console.log("Auth error"),null}var n;console.log(e)})).catch((function(e){return console.log(e),null})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"validAuth",value:function(e){return e&&e.token&&!W(e.expiresAt)}},{key:"authorizedRequest",value:function(){var e=Object(L.a)(I.a.mark((function e(t){var r,n,a=arguments;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=!(a.length>2&&void 0!==a[2])||a[2],this.validAuth(this.auth)||(console.log("Time's up, please log in again..."),alert("Time is up! Please log in again"),te.expireUser()),r.headers={Authorization:"Bearer "+this.auth.token,"Content-Type":n?"application/json":""},e.prev=4,e.next=7,P()({url:F+t,method:r.method,data:r.body||{},headers:r.headers});case 7:return e.abrupt("return",e.sent);case 10:if(e.prev=10,e.t0=e.catch(4),!e.t0.response.data){e.next=16;break}return e.abrupt("return",e.t0.response.data);case 16:return e.abrupt("return",{user_message:"There was an error",error_code:0});case 17:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedGetRequest",value:function(){var e=Object(L.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.authorizedRequest(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedPostRequest",value:function(){var e=Object(L.a)(I.a.mark((function e(t){var r,n,a=arguments;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=!(a.length>2&&void 0!==a[2])||a[2],this.validAuth(this.auth)||this.loginFromStoredTokenId(),e.abrupt("return",this.authorizedRequest(t,{body:n?JSON.stringify(r):r,method:"POST"},n));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedPutRequest",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getToken();return this.authorizedRequest(n,e,{body:r?JSON.stringify(t):t,method:"PUT"})}},{key:"authorizedPatchRequest",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getToken();return this.authorizedRequest(n,e,{body:r?JSON.stringify(t):t,method:"PATCH"})}},{key:"authorizedDeleteRequest",value:function(e){return this.validAuth(this.auth)||this.loginFromStoredTokenId(),this.authorizedRequest(e,{method:"DELETE"})}},{key:"getCollectStatus",value:function(){return this.authorizedGetRequest("/collect-status")}},{key:"postResourceSwitch",value:function(){return this.authorizedPostRequest("/switch")}},{key:"deleteResourceSwitch",value:function(){return this.authorizedDeleteRequest("/switch")}},{key:"getResultsStatus",value:function(){return this.authorizedGetRequest("/results-status")}},{key:"getResults",value:function(){return this.authorizedGetRequest("/results")}},{key:"postCircuitBreakerSwitch",value:function(){return this.authorizedPostRequest("/circuit-breaker-switch")}},{key:"deleteCircuitBreakerSwitch",value:function(){return this.authorizedDeleteRequest("/circuit-breaker-switch")}},{key:"getCircuitBreakerStatus",value:function(){return this.authorizedGetRequest("/circuit-breaker-switch")}}]),e}(),te=function(){function e(){Object(z.a)(this,e)}return Object(D.a)(e,null,[{key:"initialize",value:function(e){this.store=e,this.client=new ee}},{key:"loadApiUser",value:function(){var e=this;this.store.dispatch(h());var t=sessionStorage.getItem("dehia.auth"),r=t?JSON.parse(t):null;r&&r.token?this.reauthIfNeeded(r).then((function(t){t?e.storeUserIfValidJWT(t):(console.log("Couldn't fetch login data"),e.expireUser())})).catch((function(t){return e.expireUser()})):(console.log("Token not found"),this.expireUser())}},{key:"storeUserIfValidJWT",value:function(e){var t,r=e.token,n=function(e){if(!e)return null;try{var t=V.a.decode(e);return{name:t.name,exp:t.exp}}catch(r){return null}}(r);if(n){var a={token:r,expiresAt:1e3*n.exp};return this.client.setAuth(a),this.storeApiUser(a),this.store.dispatch((t={name:n.name},{type:u,user:t})),!0}return console.log("JWT not valid"),this.expireUser(),!1}},{key:"reauthIfNeeded",value:function(){var e=Object(L.a)(I.a.mark((function e(t){var r=this;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W(t.expiresAt)){e.next=4;break}this.login().then((function(e){console.log(e),e.data?r.storeUserIfValidJWT(e.data):(e.error_code?console.log(e.user_message):console.log("Unknown error"),r.expireUser())})),e.next=5;break;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"expireUser",value:function(){"/callback"!==window.location.pathname&&(sessionStorage.setItem("returnPath",window.location.pathname+window.location.search),sessionStorage.removeItem("dehia.auth")),this.store.dispatch({type:l})}},{key:"storeApiUser",value:function(e){sessionStorage.setItem("dehia.auth",JSON.stringify(e)),this.client.setAuth(e)}},{key:"login",value:function(){var e=Object(L.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.login();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"authorizedGetRequest",value:function(){var e=Object(L.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.authorizedGetRequest(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCollectStatus",value:function(){return this.client.getCollectStatus()}},{key:"createResourceSwitch",value:function(){return this.client.postResourceSwitch()}},{key:"removeResourceSwitch",value:function(){return this.client.deleteResourceSwitch()}},{key:"getResultsStatus",value:function(){return this.client.getResultsStatus()}},{key:"getResults",value:function(){return this.client.getResults()}},{key:"enableCircuitBreaker",value:function(){return this.client.postCircuitBreakerSwitch()}},{key:"disableCircuitBreaker",value:function(){return this.client.deleteCircuitBreakerSwitch()}},{key:"getCircuitBreakerStatus",value:function(){return this.client.getCircuitBreakerStatus()}}]),e}();te.store=null;var re=r(332),ne=r(331),ae=function(e){var t=e.metrics,r=e.cb;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Test the current configuration"})}),Object(T.jsx)(ne.a.Body,{children:t.testStarted?Object(T.jsxs)("div",{children:[Object(T.jsxs)(M.a,{children:[Object(T.jsx)(re.a,{variant:"info",children:"*Metrics are taken from the frontend, and includes the trip [frontend -> gateway -> service1 (->service2 -> service1) -> gateway -> frontend]"}),Object(T.jsx)(G.a,{children:Object(T.jsx)("progress",{value:t.step,max:"10",children:" 32% "})}),Object(T.jsx)(G.a,{children:t.loading&&Object(T.jsx)(E.a,{animation:"border",role:"status"})})]}),Object(T.jsxs)(M.a,{children:[Object(T.jsx)(G.a,{md:12,children:Object(T.jsx)("ul",{children:t.text.map((function(e,t){return Object(T.jsx)("li",{children:e},t)}))})}),Object(T.jsx)(G.a,{children:t.loading?Object(T.jsx)(B.a,{onClick:r.stopTest,variant:"danger",children:"Stop current test"}):t.testStarted&&Object(T.jsx)("div",{children:Object(T.jsx)(B.a,{onClick:r.startTest,variant:"primary",children:"Restart test"})})})]})]}):Object(T.jsx)(B.a,{onClick:r.startTest,variant:"primary",children:"Start test"})})]})},se=r(39),ce=r.n(se),ie=function(e){if(e.loading)return"secondary";if(e.error)return"danger";switch(e.status){case"OK":return"success";case"SUSPENDED":return"warning";default:return"primary"}},oe=function(e){var t=e.collect,r=e.cb,n=t.status,a=t.error,s=t.loading;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Collect Service"})}),Object(T.jsx)(ne.a.Body,{children:s?Object(T.jsx)(_,{}):Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsxs)(re.a,{variant:ie(t),children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:["Status: ",a||n]})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:t.checked?Object(T.jsxs)(B.a,{className:"float-right",variant:"success",disabled:t.disabled,onClick:function(e){return r.onChangeCollect(!0)},children:["Enable Endpoint ",Object(T.jsx)(ce.a,{name:"ethernet-cable",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]}):Object(T.jsxs)(B.a,{className:"float-right",variant:"warning",disabled:t.disabled,onClick:function(e){return r.onChangeCollect(!1)},children:["Disable Endpoint ",Object(T.jsx)(ce.a,{name:"ethernet-cable-off",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]})})})]})})})})]})},ue=function(e){if(e.resultsLoading)return"secondary";if(e.error)return"danger";switch(e.status){case"OK":return"success";case"SUSPENDED":return"warning";default:return"primary"}},le=function(e){var t=e.results,r=e.cb,n=t.status,a=t.error,s=t.loading,c=t.resultsLoading,i=t.data,o=t.circuitBreakerEnabled,u=t.circuitBreakerLoading;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Results Service"})}),Object(T.jsx)(ne.a.Body,{children:s?Object(T.jsx)(_,{}):Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsxs)(re.a,{variant:ue(t),children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:["Status: ",a||(c?"Fetching results...":n)," ",Object(T.jsx)("br",{}),"Circuit Breaker: ",o?"Enabled":"Disabled"," ",Object(T.jsx)("br",{}),Object(T.jsx)("br",{})]})}),Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:[Object(T.jsxs)(B.a,{onClick:r.onClickRetrieve,children:["Retrieve results ",Object(T.jsx)(ce.a,{name:"download",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]}),u?Object(T.jsx)(_,{}):o?Object(T.jsxs)(B.a,{variant:"secondary",onClick:function(e){return r.onChangeCircuitBreaker(!1)},className:"float-right",children:[" Disable Circuit Breaker ",Object(T.jsx)(ce.a,{name:"pipe",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]}):Object(T.jsxs)(B.a,{variant:"warning",onClick:function(e){return r.onChangeCircuitBreaker(!0)},className:"float-right",children:[" Enable Circuit Breaker ",Object(T.jsx)(ce.a,{name:"pipe-disconnected",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]})]})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:"\xa0"})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:c?Object(T.jsx)(_,{}):i&&Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:"Results"}),Object(T.jsx)(ne.a.Body,{children:Object(T.jsx)("ul",{children:i.map((function(e,t){return Object(T.jsx)("li",{children:e},t)}))})})]})})})]})})})})]})};var de=function(e){var t=e.name,r=e.collect,n=e.results,a=e.metrics,s=e.cb;return Object(T.jsxs)("div",{children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:[Object(T.jsxs)("h2",{children:[t,"'s Session"]}),Object(T.jsx)(re.a,{variant:"warning",children:"The services and gateway are hosted on Heroku - Please be patient the first time you open the app"})]})}),Object(T.jsxs)(M.a,{children:[Object(T.jsxs)(G.a,{children:[Object(T.jsx)(oe,{collect:r,cb:s}),Object(T.jsx)(ae,{metrics:a,cb:s})]}),Object(T.jsx)(G.a,{children:Object(T.jsx)(le,{results:n,cb:s})})]})]})},he=function(e){Object(A.a)(r,e);var t=Object(q.a)(r);function r(){var e;return Object(z.a)(this,r),(e=t.call(this)).stopTest=function(t){var r=e.state.metrics;r.stop=!0,r.loading=!1,e.setState({metrics:r})},e.startTest=function(){var t=Object(L.a)(I.a.mark((function t(r){var n,a,s,c,i,o,u,l,d,h,j,b;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=e.state.metrics).testStarted=!0,n.stop=!1,e.setState({metrics:n}),a=[],s=[],"OK"===e.state.collect.status?a[0]="Operation should be normal. Sending first request...":e.state.results.circuitBreakerEnabled?a[0]="Circuit breaker enabled. Sending first request...":a[0]="Circuit breaker disabled. Sending first request...",(n=e.state.metrics).text=a,n.loading=!0,e.setState({metrics:n}),c=1;case 12:if(!(c<=10)){t.next=40;break}if(!e.state.metrics.stop){t.next=18;break}return a[a.length]="Test stopped",n.text=a,e.setState({metrics:n}),t.abrupt("return");case 18:return i=Date.now(),o=void 0,t.prev=20,t.next=23,te.getResults();case 23:u=t.sent,o=void 0!==u.error_code,t.next=30;break;case 27:t.prev=27,t.t0=t.catch(20),o=!0;case 30:l=Date.now(),d=new Date(l).getTime()-new Date(i).getTime(),a[c]="Request ".concat(c,". Elapsed time: ").concat(d,"ms (").concat(o?"Failed":"Success",")"),s[c-1]=d,n.step=c,n.text=a,e.setState({metrics:n});case 37:c++,t.next=12;break;case 40:h=s.reduce((function(e,t){return e+t}))/10,j=s.reduce((function(e,t){return e>t?e:t})),b=s.reduce((function(e,t){return e<t?e:t})),n.loading=!1,a[11]="Average: ".concat(h.toFixed(2),"ms."),a[12]="Max time: ".concat(j,"ms. Min time: ").concat(b,"ms"),e.setState({metrics:n});case 47:case"end":return t.stop()}}),t,null,[[20,27]])})));return function(e){return t.apply(this,arguments)}}(),e.onClickRetrieve=function(t){var r=e.state.results;r.resultsLoading=!0,e.setState({results:r}),te.getResults().then((function(t){if(t.data)if(t.error_code){var r=e.state.results;r.error=t.user_message,r.resultsLoading=!1,r.data=null,e.setState({results:r})}else{var n=e.state.results;n.data=t.data.results,n.resultsLoading=!1,n.error=null,e.setState({results:n})}else{var a=e.state.results;t.developer_message?a.error=t.developer_message:a.error="Unknown Error",a.data=null,a.resultsLoading=!1,e.setState({results:a})}}))},e.onChangeBreaker=function(t){if(t){var r=e.state.results;r.circuitBreakerLoading=!0,e.setState({results:r}),te.enableCircuitBreaker().then((function(t){if(200!==t.status)if(t.error_code)console.log(t),e.setState({results:{circuitBreakerEnabled:!1,circuitBreakerLoading:!1,error:"Error"}});else{console.log(t);var r=e.state.results;r.circuitBreakerLoading=!1,r.error="Unknown Error",e.setState({results:r})}else e.setState({results:{circuitBreakerLoading:!1,circuitBreakerEnabled:!0,error:null,status:"Circuit breaker enabled"}})})).catch((function(t){console.log(t),e.setState({results:{circuitBreakerEnabled:!1,circuitBreakerLoading:!1,error:"Error"}})}))}else{var n=e.state.results;n.circuitBreakerLoading=!0,e.setState({results:n}),te.disableCircuitBreaker().then((function(t){if(200!==t.status&&304!==t.status)if(t.error_code)e.setState({results:{error:t.user_message,loading:!1}});else{console.log(t);var r=e.state.results;r.circuitBreakerLoading=!1,r.error="Unknown Error",e.setState({results:r})}else{var n=e.state.results;n.circuitBreakerLoading=!1,n.circuitBreakerEnabled=!1,n.error=null,e.setState({results:n})}})).catch((function(t){console.log(t),e.setState({results:{circuitBreakerLoading:!1,error:"Unknown error"}})}))}},e.onChangeCollect=function(t){if(!e.state.collect.disabled)if(t){var r=e.state.collect;r.loading=!0,e.setState({collect:r}),te.removeResourceSwitch().then((function(t){200!==t.status&&304!==t.status?t.error_code?e.setState({collect:{error:t.user_message,loading:!1}}):(console.log(t),e.setState({collect:{error:"Unknown error",loading:!1}})):e.setState({collect:{loading:!1,error:null,disabled:!1,checked:!1,status:"OK"}})})).catch((function(t){console.log(t),e.setState({collect:{loading:!1,error:"Error"}})}))}else{var n=e.state.collect;n.loading=!0,e.setState({collect:n}),te.createResourceSwitch().then((function(t){t.error_code?(console.log(t),e.setState({collect:{loading:!1,error:"Error"}})):e.setState({collect:{loading:!1,error:null,disabled:!1,checked:!0,status:"SUSPENDED"}})})).catch((function(t){console.log(t),e.setState({collect:{loading:!1,error:"Error"}})}))}},e.loadCollectStatus=function(){te.getCollectStatus().then((function(t){200!==t.status&&304!==t.status?t.error_code?e.setState({collect:{error:t.user_message,loading:!1,disabled:!0}}):e.setState({collect:{error:"Unknown error",loading:!1,disabled:!0}}):e.setState({collect:{status:t.data.status,loading:!1,checked:"OK"!==t.data.status,disabled:!1}})})).catch((function(e){console.log(e)}))},e.loadResultsStatus=function(){te.getResultsStatus().then((function(t){200!==t.status&&304!==t.status?t.error_code?e.setState({results:{error:t.user_message,loading:!1,disabled:!0}}):(console.log(t),e.setState({results:{error:"Unknown error",loading:!1,disabled:!0}})):e.setState({results:{status:t.data.status,loading:!1,checked:"OK"!==t.status,disabled:!1}})})).catch((function(e){console.log(e)}));var t=e.state.results;t.circuitBreakerLoading=!0,e.setState({results:t}),te.getCircuitBreakerStatus().then((function(t){var r=e.state.results;r.circuitBreakerLoading=!1,r.circuitBreakerEnabled="enabled"===t.data.status,e.setState({results:r})})).catch((function(t){console.log(t);var r=e.state.results;r.error="Unknown error",r.circuitBreakerLoading=!1,e.setState({results:r})}))},e.loadStatus=Object(L.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.loadCollectStatus(),e.loadResultsStatus();case 2:case"end":return t.stop()}}),t)}))),e.state={collect:{loading:!0,error:null,disabled:!0,checked:!1,status:null},results:{loading:!0,resultsLoading:!1,error:null,circuitBreakerEnabled:!1,circuitBreakerLoading:!1,data:null},metrics:{testStarted:!1,step:0,text:[],loading:!1,stop:!1}},e}return Object(D.a)(r,[{key:"componentDidMount",value:function(){this.loadStatus()}},{key:"render",value:function(){return Object(T.jsx)(de,{name:this.props.name,collect:this.state.collect,results:this.state.results,metrics:this.state.metrics,cb:{onChangeCollect:this.onChangeCollect,onClickRetrieve:this.onClickRetrieve,onChangeCircuitBreaker:this.onChangeBreaker,startTest:this.startTest,stopTest:this.stopTest}})}}]),r}(n.Component);var je=Object(i.b)((function(e){return{name:e.auth.name}}))(he),be=function(e){Object(A.a)(r,e);var t=Object(q.a)(r);function r(){var e;Object(z.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).logout=function(t){sessionStorage.removeItem("auth"),e.props.dispatch(b())},e}return Object(D.a)(r,[{key:"render",value:function(){return Object(T.jsx)(Y,{loggedIn:this.props.loggedIn,logout:this.logout})}}]),r}(n.Component),fe=Object(i.b)((function(e){return{}}))(be),ge=function(e){e.match.params;return Object(T.jsxs)("div",{children:[Object(T.jsx)(fe,{loggedIn:!0}),Object(T.jsx)(C.a,{children:Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{style:{padding:"2em"},children:Object(T.jsx)(je,{})})})})]})},pe=function(e){Object(A.a)(r,e);var t=Object(q.a)(r);function r(){return Object(z.a)(this,r),t.apply(this,arguments)}return Object(D.a)(r,[{key:"componentDidMount",value:function(){this.props.dispatch(h()),te.login().then((function(e){e?te.storeUserIfValidJWT(e):te.expireUser()})).catch((function(e){console.log(e)})),this.props.history.push("/")}},{key:"render",value:function(){return Object(T.jsxs)("div",{children:[Object(T.jsx)(Y,{loggedIn:!1}),Object(T.jsx)(_,{})]})}}]),r}(n.Component),Oe=Object(i.b)((function(e){return{}}))(pe),ve=function(e){e.match.params;var t=e.history;return Object(T.jsx)(Oe,{history:t})};var xe=function(){return Object(T.jsx)(y.a,{basename:"/",children:Object(T.jsxs)(C.a,{style:{marginTop:"1em"},children:[Object(T.jsx)(w.a,{path:"/",exact:!0,component:$(ge)}),Object(T.jsx)(w.a,{path:"/login",component:ve})]})})},me=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.c,ke=Object(c.d)(g,me());te.initialize(ke),te.loadApiUser(),s.a.render(Object(T.jsx)(i.a,{store:ke,children:Object(T.jsx)(xe,{})}),document.getElementById("root"))}},[[323,1,2]]]);
//# sourceMappingURL=main.588be5b1.chunk.js.map