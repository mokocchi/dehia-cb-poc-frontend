(this["webpackJsonpdehia-cb-poc-frontend"]=this["webpackJsonpdehia-cb-poc-frontend"]||[]).push([[0],{222:function(e,t,r){},246:function(e,t){},248:function(e,t){},261:function(e,t){},263:function(e,t){},291:function(e,t){},292:function(e,t){},297:function(e,t){},299:function(e,t){},306:function(e,t){},325:function(e,t){},452:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r(32),s=r.n(a),c=r(41),i=r(26),o=r(36),u="API_USER_FOUND";var l="API_USER_EXPIRED";var d="LOADING_API_USER";function h(){return{type:d}}var j="API_USER_LOGGED_OUT";function b(){return{type:j}}var f={name:null,isLoading:!1};var g=Object(c.b)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return Object(o.a)(Object(o.a)({},e),{},{name:t.user.name,isLoading:!1});case l:case j:return f;case d:return Object(o.a)(Object(o.a)({},f),{},{isLoading:!0});default:return e}}}),p=r(204),O=r(205),x=r(206),v=r(207),m=r(208),k="\n@font-face {\n  src: url(".concat(p.a,");\n  font-family: FontAwesome;\n}\n@font-face {\n  src: url(").concat(O.a,");\n  font-family: Entypo;\n}\n@font-face {\n    src: url(").concat(x.a,");\n    font-family: Ionicons;\n}\n@font-face {\n    src: url(").concat(v.a,");\n    font-family: MaterialIcons;\n}\n@font-face {\n  src: url(").concat(m.a,");\n  font-family: MaterialCommunityIcons;\n}\n"),S=document.createElement("style");S.type="text/css",S.styleSheet?S.styleSheet.cssText=k:S.appendChild(document.createTextNode(k)),document.head.appendChild(S);var y=r(79),w=r(11),C=r(457),R=(r(222),r(458)),B=r(454),E=r(455),T=r(1);var _=function(e){var t=e.text;return Object(T.jsxs)(R.a.Control,{as:B.a,variant:"Light",disabled:!0,children:[Object(T.jsx)(E.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),t||"Loading..."]})},I=r(9),U=r.n(I),L=r(17),A=r(22),z=r(23),D=r(34),q=r(33),N=r(58),P=r.n(N),M=r(456),G=r(209),J=r(460),F="https://dehia-cb-poc-gateway.herokuapp.com",H="".concat(F,"/api/v1.0"),K="".concat(F,"/login"),V=r(210),W=r.n(V);function X(e){return Date.now()>e}var Y=r(459),Q=function(e){var t=e.loggedIn,r=e.logout;return Object(T.jsxs)(Y.a,{className:"navbar",bg:"primary",children:[Object(T.jsxs)(Y.a.Brand,{children:["Circuit Breaker PoC ",t&&"- Dashboard"]}),t&&Object(T.jsx)(B.a,{onClick:r,className:"float-right",variant:"outline-light",children:"Logout"})]})},Z=function(e){Object(D.a)(r,e);var t=Object(q.a)(r);function r(){var e;Object(A.a)(this,r),(e=t.call(this)).pingGateway=Object(L.a)(U.a.mark((function t(){return U.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:P()(F).then((function(t){200===t.status&&e.setState({loading:!1})})).catch((function(e){return console.log(e)}));case 1:case"end":return t.stop()}}),t)})));var n=sessionStorage.getItem("error");return sessionStorage.removeItem("error"),e.state={loading:!0,error:n},e}return Object(z.a)(r,[{key:"componentDidMount",value:function(){var e=this;(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;return new Promise((function r(n){e()?n():setTimeout((function(e){return r(n)}),t)}))})((function(t){return e.pingGateway()&&!1===e.state.loading}),5e3).then((function(t){return e.setState({loading:!1})}))}},{key:"render",value:function(){return Object(T.jsxs)("div",{children:[Object(T.jsx)(Q,{loggedIn:!1}),this.state.loading?Object(T.jsx)("div",{children:Object(T.jsx)(_,{text:"Starting..."})}):Object(T.jsxs)("div",{className:"App",children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:[this.state.error&&"login_failed"===this.state.error?Object(T.jsx)(J.a,{variant:"danger",children:"Login failed. See the API response in the network panel for details."}):"seats_taken"===this.state.error&&Object(T.jsx)(J.a,{variant:"warning",children:"Max users reached. Please stand by."}),Object(T.jsxs)("p",{children:["This is a proof of concept for the ",Object(T.jsx)("a",{href:"https://docs.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker",children:"Circuit Breaker"})," pattern. ",Object(T.jsx)("br",{}),"Log in to see the dashboard.",Object(T.jsx)("br",{}),"You have 15 minutes."]})]})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsx)(y.b,{className:"loginButton",to:"/login",children:Object(T.jsx)(B.a,{variant:"outline-dark",children:"Login"})})})})]})]})}}]),r}(n.Component);function $(e){return{auth:e.auth}}var ee=function(e){return Object(i.b)($)((function(t){return t.auth.isLoading?Object(T.jsx)(_,{}):t.auth.name?Object(T.jsx)(e,Object(o.a)({},t)):Object(T.jsx)(Z,Object(o.a)({},t))}))},te=function(){function e(){Object(A.a)(this,e)}return Object(z.a)(e,[{key:"setAuth",value:function(e){this.auth=e}},{key:"login",value:function(){var e=Object(L.a)(U.a.mark((function e(){var t=this;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",P.a.post(K,{token:!0}).then((function(e){if(!e.error_code){if(e.data){var r={token:e.data.accessToken,expiresAt:(n=e.data.expires_in,Date.now()+n)};return t.setAuth(r),r}return console.log("Auth error"),null}var n;console.log(e)})).catch((function(e){throw e})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"validAuth",value:function(e){return e&&e.token&&!X(e.expiresAt)}},{key:"authorizedRequest",value:function(){var e=Object(L.a)(U.a.mark((function e(t){var r,n,a=arguments;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=!(a.length>2&&void 0!==a[2])||a[2],this.validAuth(this.auth)||(console.log("Time's up, please log in again..."),alert("Time is up! Please log in again"),re.expireUser()),r.headers={Authorization:"Bearer "+this.auth.token,"Content-Type":n?"application/json":""},e.prev=4,e.next=7,P()({url:H+t,method:r.method,data:r.body||{},headers:r.headers});case 7:return e.abrupt("return",e.sent);case 10:if(e.prev=10,e.t0=e.catch(4),!e.t0.response.data){e.next=16;break}return e.abrupt("return",e.t0.response.data);case 16:return e.abrupt("return",{user_message:"There was an error",error_code:0});case 17:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedGetRequest",value:function(){var e=Object(L.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.authorizedRequest(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedPostRequest",value:function(){var e=Object(L.a)(U.a.mark((function e(t){var r,n,a=arguments;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=!(a.length>2&&void 0!==a[2])||a[2],this.validAuth(this.auth)||this.loginFromStoredTokenId(),e.abrupt("return",this.authorizedRequest(t,{body:n?JSON.stringify(r):r,method:"POST"},n));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizedPutRequest",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getToken();return this.authorizedRequest(n,e,{body:r?JSON.stringify(t):t,method:"PUT"})}},{key:"authorizedPatchRequest",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getToken();return this.authorizedRequest(n,e,{body:r?JSON.stringify(t):t,method:"PATCH"})}},{key:"authorizedDeleteRequest",value:function(e){return this.validAuth(this.auth)||this.loginFromStoredTokenId(),this.authorizedRequest(e,{method:"DELETE"})}},{key:"getCollectStatus",value:function(){return this.authorizedGetRequest("/collect-status")}},{key:"postResourceSwitch",value:function(){return this.authorizedPostRequest("/switch")}},{key:"deleteResourceSwitch",value:function(){return this.authorizedDeleteRequest("/switch")}},{key:"getResultsStatus",value:function(){return this.authorizedGetRequest("/results-status")}},{key:"getResults",value:function(){return this.authorizedGetRequest("/results")}},{key:"postCircuitBreakerSwitch",value:function(){return this.authorizedPostRequest("/circuit-breaker-switch")}},{key:"deleteCircuitBreakerSwitch",value:function(){return this.authorizedDeleteRequest("/circuit-breaker-switch")}},{key:"getCircuitBreakerStatus",value:function(){return this.authorizedGetRequest("/circuit-breaker-switch")}}]),e}(),re=function(){function e(){Object(A.a)(this,e)}return Object(z.a)(e,null,[{key:"initialize",value:function(e){this.store=e,this.client=new te}},{key:"loadApiUser",value:function(){var e=this;this.store.dispatch(h());var t=sessionStorage.getItem("dehia.auth"),r=t?JSON.parse(t):null;r&&r.token?this.reauthIfNeeded(r).then((function(t){t?e.storeUserIfValidJWT(t):(console.log("Couldn't fetch login data"),e.expireUser())})).catch((function(t){return e.expireUser()})):(console.log("Token not found"),this.expireUser())}},{key:"storeUserIfValidJWT",value:function(e){var t,r=e.token,n=function(e){if(!e)return null;try{var t=W.a.decode(e);return{name:t.name,exp:t.exp}}catch(r){return null}}(r);if(n){var a={token:r,expiresAt:1e3*n.exp};return this.client.setAuth(a),this.storeApiUser(a),this.store.dispatch((t={name:n.name},{type:u,user:t})),!0}return console.log("JWT not valid"),this.expireUser(),!1}},{key:"reauthIfNeeded",value:function(){var e=Object(L.a)(U.a.mark((function e(t){var r=this;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!X(t.expiresAt)){e.next=4;break}this.login().then((function(e){console.log(e),e.data?r.storeUserIfValidJWT(e.data):(e.error_code?console.log(e.user_message):console.log("Unknown error"),r.expireUser())})).catch((function(e){e.response.error_code?console.log(e.response.user_message):console.log("Unknown error"),r.expireUser()})),e.next=5;break;case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"expireUser",value:function(){"/callback"!==window.location.pathname&&(sessionStorage.setItem("returnPath",window.location.pathname+window.location.search),sessionStorage.removeItem("dehia.auth")),this.store.dispatch({type:l})}},{key:"storeApiUser",value:function(e){sessionStorage.setItem("dehia.auth",JSON.stringify(e)),this.client.setAuth(e)}},{key:"login",value:function(){var e=Object(L.a)(U.a.mark((function e(){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.login();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"authorizedGetRequest",value:function(){var e=Object(L.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.authorizedGetRequest(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCollectStatus",value:function(){return this.client.getCollectStatus()}},{key:"createResourceSwitch",value:function(){return this.client.postResourceSwitch()}},{key:"removeResourceSwitch",value:function(){return this.client.deleteResourceSwitch()}},{key:"getResultsStatus",value:function(){return this.client.getResultsStatus()}},{key:"getResults",value:function(){return this.client.getResults()}},{key:"enableCircuitBreaker",value:function(){return this.client.postCircuitBreakerSwitch()}},{key:"disableCircuitBreaker",value:function(){return this.client.deleteCircuitBreakerSwitch()}},{key:"getCircuitBreakerStatus",value:function(){return this.client.getCircuitBreakerStatus()}}]),e}();re.store=null;var ne=r(461),ae=function(e){var t=e.metrics,r=e.cb;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Test the current configuration"})}),Object(T.jsxs)(ne.a.Body,{className:"metrics-card-body",children:[Object(T.jsx)(J.a,{variant:"warning",children:Object(T.jsxs)("ol",{children:[Object(T.jsx)("li",{children:"Metrics are taken from the frontend"}),Object(T.jsx)("li",{children:"b) The worst case scenario may take up to 3 minutes"})]})}),t.testStarted?Object(T.jsxs)("div",{children:[Object(T.jsxs)(M.a,{children:[Object(T.jsx)(G.a,{children:Object(T.jsx)("progress",{value:t.step,max:"10",children:" 32% "})}),Object(T.jsx)(G.a,{children:t.loading&&Object(T.jsx)(E.a,{animation:"border",role:"status"})})]}),Object(T.jsxs)(M.a,{children:[Object(T.jsx)(G.a,{md:12,children:Object(T.jsx)("ul",{children:t.text.map((function(e,t){return Object(T.jsx)("li",{children:e},t)}))})}),Object(T.jsx)(G.a,{children:t.loading?Object(T.jsx)(B.a,{onClick:r.stopTest,variant:"danger",children:"Stop current test"}):t.testStarted&&Object(T.jsx)("div",{children:Object(T.jsx)(B.a,{onClick:r.startTest,variant:"primary",children:"Restart test"})})})]})]}):Object(T.jsx)(B.a,{onClick:r.startTest,variant:"primary",children:"Start test"})]})]})},se=r(42),ce=r.n(se),ie=function(e){if(e.loading)return"secondary";if(e.error)return"danger";switch(e.status){case"OK":return"success";case"SUSPENDED":return"warning";default:return"primary"}},oe=function(e){var t=e.collect,r=e.cb,n=t.status,a=t.error,s=t.loading;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Collect Service"})}),Object(T.jsx)(ne.a.Body,{children:s?Object(T.jsx)(_,{}):Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsxs)(J.a,{variant:ie(t),children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:["Status: ",a||n]})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:t.checked?Object(T.jsxs)(B.a,{className:"float-right",variant:"success",disabled:t.disabled,onClick:function(e){return r.onChangeCollect(!0)},children:["Enable Endpoint ",Object(T.jsx)(ce.a,{name:"ethernet-cable",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]}):Object(T.jsxs)(B.a,{className:"float-right",variant:"warning",disabled:t.disabled,onClick:function(e){return r.onChangeCollect(!1)},children:["Disable Endpoint ",Object(T.jsx)(ce.a,{name:"ethernet-cable-off",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]})})})]})})})})]})},ue=function(e){if(e.resultsLoading)return"secondary";if(e.error)return"danger";switch(e.status){case"OK":return"success";case"SUSPENDED":return"warning";default:return"primary"}},le=function(e){var t=e.results,r=e.cb,n=t.status,a=t.error,s=t.loading,c=t.resultsLoading,i=t.data,o=t.circuitBreakerEnabled,u=t.circuitBreakerLoading;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Results Service"})}),Object(T.jsx)(ne.a.Body,{children:s?Object(T.jsx)(_,{}):Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsxs)(J.a,{variant:ue(t),children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:["Status: ",a||(c?"Fetching results...":n)," ",Object(T.jsx)("br",{}),"Circuit Breaker: ",o?"Enabled":"Disabled"," ",Object(T.jsx)("br",{}),Object(T.jsx)("br",{})]})}),Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:[Object(T.jsxs)(B.a,{onClick:r.onClickRetrieve,children:["Retrieve results ",Object(T.jsx)(ce.a,{name:"download",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]}),u?Object(T.jsx)(_,{}):o?Object(T.jsxs)(B.a,{variant:"secondary",onClick:function(e){return r.onChangeCircuitBreaker(!1)},className:"float-right",children:[" Disable Circuit Breaker ",Object(T.jsx)(ce.a,{name:"pipe",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]}):Object(T.jsxs)(B.a,{variant:"warning",onClick:function(e){return r.onChangeCircuitBreaker(!0)},className:"float-right",children:[" Enable Circuit Breaker ",Object(T.jsx)(ce.a,{name:"pipe-disconnected",font:"MaterialCommunityIcons",color:"white",size:"1.5rem"})]})]})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:"\xa0"})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:c?Object(T.jsx)(_,{}):i&&Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:"Results"}),Object(T.jsx)(ne.a.Body,{children:Object(T.jsx)("ul",{children:i.map((function(e,t){return Object(T.jsx)("li",{children:e},t)}))})})]})})})]})})})})]})},de=r(213),he=function(e){for(var t=[],r=0;r<10;r++){var n="R".concat(r+1);t.push(n)}return t},je=function(e){var t=e.metrics,r=e.cb;return Object(T.jsxs)(ne.a,{children:[Object(T.jsx)(ne.a.Header,{children:Object(T.jsx)("h3",{children:"Charts"})}),Object(T.jsxs)(ne.a.Body,{children:[Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsx)(de.Line,{data:{labels:he(),datasets:t.datasets},options:{scales:{yAxes:[{ticks:{suggestedMin:0,suggestedMax:8e3}}]},showLines:!0}})})}),Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{children:Object(T.jsx)(B.a,{onClick:r.onClickClear,children:"Clear"})})})]})]})};var be=function(e){var t=e.name,r=e.collect,n=e.results,a=e.metrics,s=e.cb;return Object(T.jsxs)("div",{children:[Object(T.jsx)(M.a,{children:Object(T.jsxs)(G.a,{children:[Object(T.jsxs)("h2",{children:[t,"'s Session"]}),Object(T.jsx)(J.a,{variant:"warning",children:"The services and gateway are hosted on Heroku - Please be patient the first time you open the app"})]})}),Object(T.jsxs)(M.a,{children:[Object(T.jsxs)(G.a,{children:[Object(T.jsx)(oe,{collect:r,cb:s}),Object(T.jsx)(ae,{metrics:a,cb:s})]}),Object(T.jsxs)(G.a,{children:[Object(T.jsx)(le,{results:n,cb:s}),a.data&&Object(T.jsx)(je,{metrics:a,cb:s})]})]})]})};function fe(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}var ge=function(e){Object(D.a)(r,e);var t=Object(q.a)(r);function r(){var e;return Object(A.a)(this,r),(e=t.call(this)).onClickClear=function(t){var r=e.state.metrics;r.data=!1,r.datasets=[],e.setState({metrics:r})},e.stopTest=function(t){var r=e.state.metrics;r.stop=!0,r.loading=!1,e.setState({metrics:r})},e.startTest=function(){var t=Object(L.a)(U.a.mark((function t(r){var n,a,s,c,i,o,u,l,d,h,j,b,f,g,p;return U.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=e.state.metrics).testStarted=!0,n.stop=!1,n.step=0,e.setState({metrics:n}),a=[],s=[],"OK"===e.state.collect.status?a[0]="Operation should be normal. Sending first request...":e.state.results.circuitBreakerEnabled?a[0]="Circuit breaker enabled. Sending first request...":a[0]="Circuit breaker disabled. Sending first request...",(n=e.state.metrics).text=a,n.loading=!0,e.setState({metrics:n}),c=1;case 13:if(!(c<=10)){t.next=43;break}if(!e.state.metrics.stop){t.next=19;break}return a[a.length]="Test stopped",n.text=a,e.setState({metrics:n}),t.abrupt("return");case 19:return i=Date.now(),o=void 0,u=!1,t.prev=22,t.next=25,re.getResults();case 25:(l=t.sent).data.results?(console.log(l.data.results[0]),u="old"===l.data.results[0]):o=!0,t.next=33;break;case 29:t.prev=29,t.t0=t.catch(22),console.log(t.t0),o=!0;case 33:d=Date.now(),h=new Date(d).getTime()-new Date(i).getTime(),a[c]="Request ".concat(c,". Elapsed time: ").concat(h,"ms (").concat(o?"Failed":u?"Substitute results":"Success",")"),s[c-1]=h,n.step=c,n.text=a,e.setState({metrics:n});case 40:c++,t.next=13;break;case 43:j=s.reduce((function(e,t){return e+t}))/10,b=s.reduce((function(e,t){return e>t?e:t})),f=s.reduce((function(e,t){return e<t?e:t})),n.loading=!1,a[a.length]="Average: ".concat(j.toFixed(2),"ms."),a[a.length]="Max time: ".concat(b,"ms. Min time: ").concat(f,"ms"),n.text=a,n.data=!0,console.log("Test result:"),console.log(s),g=n.datasets,p=fe(),g[g.length]={label:"Test ".concat(g.length+1),fill:!1,backgroundColor:p,borderColor:p,data:s.map((function(e,t){return{x:t+1,y:e}}))},n.datasets=g,e.setState({metrics:n});case 58:case"end":return t.stop()}}),t,null,[[22,29]])})));return function(e){return t.apply(this,arguments)}}(),e.onClickRetrieve=function(t){var r=e.state.results;r.resultsLoading=!0,e.setState({results:r}),re.getResults().then((function(t){if(t.data)if(t.error_code){var r=e.state.results;r.error=t.user_message,r.resultsLoading=!1,r.data=null,e.setState({results:r})}else{var n=e.state.results;n.data=t.data.results,n.resultsLoading=!1,n.error=null,e.setState({results:n})}else{var a=e.state.results;t.developer_message?a.error=t.developer_message:a.error="Unknown Error",a.data=null,a.resultsLoading=!1,e.setState({results:a})}}))},e.onChangeBreaker=function(t){if(t){var r=e.state.results;r.circuitBreakerLoading=!0,e.setState({results:r}),re.enableCircuitBreaker().then((function(t){if(200!==t.status)if(t.error_code)console.log(t),e.setState({results:{circuitBreakerEnabled:!1,circuitBreakerLoading:!1,error:"Error"}});else{console.log(t);var r=e.state.results;r.circuitBreakerLoading=!1,r.error="Unknown Error",e.setState({results:r})}else e.setState({results:{circuitBreakerLoading:!1,circuitBreakerEnabled:!0,error:null,status:"Circuit breaker enabled"}})})).catch((function(t){console.log(t),e.setState({results:{circuitBreakerEnabled:!1,circuitBreakerLoading:!1,error:"Error"}})}))}else{var n=e.state.results;n.circuitBreakerLoading=!0,e.setState({results:n}),re.disableCircuitBreaker().then((function(t){if(200!==t.status&&304!==t.status)if(t.error_code)e.setState({results:{error:t.user_message,loading:!1}});else{console.log(t);var r=e.state.results;r.circuitBreakerLoading=!1,r.error="Unknown Error",e.setState({results:r})}else{var n=e.state.results;n.circuitBreakerLoading=!1,n.circuitBreakerEnabled=!1,n.error=null,e.setState({results:n})}})).catch((function(t){console.log(t),e.setState({results:{circuitBreakerLoading:!1,error:"Unknown error"}})}))}},e.onChangeCollect=function(t){if(!e.state.collect.disabled)if(t){var r=e.state.collect;r.loading=!0,e.setState({collect:r}),re.removeResourceSwitch().then((function(t){200!==t.status&&304!==t.status?t.error_code?e.setState({collect:{error:t.user_message,loading:!1}}):(console.log(t),e.setState({collect:{error:"Unknown error",loading:!1}})):e.setState({collect:{loading:!1,error:null,disabled:!1,checked:!1,status:"OK"}})})).catch((function(t){console.log(t),e.setState({collect:{loading:!1,error:"Error"}})}))}else{var n=e.state.collect;n.loading=!0,e.setState({collect:n}),re.createResourceSwitch().then((function(t){t.error_code?(console.log(t),e.setState({collect:{loading:!1,error:"Error"}})):e.setState({collect:{loading:!1,error:null,disabled:!1,checked:!0,status:"SUSPENDED"}})})).catch((function(t){console.log(t),e.setState({collect:{loading:!1,error:"Error"}})}))}},e.loadCollectStatus=function(){re.getCollectStatus().then((function(t){200!==t.status&&304!==t.status?t.error_code?e.setState({collect:{error:t.user_message,loading:!1,disabled:!0}}):e.setState({collect:{error:"Unknown error",loading:!1,disabled:!0}}):e.setState({collect:{status:t.data.status,loading:!1,checked:"OK"!==t.data.status,disabled:!1}})})).catch((function(e){console.log(e)}))},e.loadResultsStatus=function(){re.getResultsStatus().then((function(t){200!==t.status&&304!==t.status?t.error_code?e.setState({results:{error:t.user_message,loading:!1,disabled:!0}}):(console.log(t),e.setState({results:{error:"Unknown error",loading:!1,disabled:!0}})):e.setState({results:{status:t.data.status,loading:!1,checked:"OK"!==t.status,disabled:!1}})})).catch((function(e){console.log(e)}));var t=e.state.results;t.circuitBreakerLoading=!0,e.setState({results:t}),re.getCircuitBreakerStatus().then((function(t){var r=e.state.results;r.circuitBreakerLoading=!1,r.circuitBreakerEnabled="enabled"===t.data.status,e.setState({results:r})})).catch((function(t){console.log(t);var r=e.state.results;r.error="Unknown error",r.circuitBreakerLoading=!1,e.setState({results:r})}))},e.loadStatus=Object(L.a)(U.a.mark((function t(){return U.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.loadCollectStatus(),e.loadResultsStatus();case 2:case"end":return t.stop()}}),t)}))),e.state={collect:{loading:!0,error:null,disabled:!0,checked:!1,status:null},results:{loading:!0,resultsLoading:!1,error:null,circuitBreakerEnabled:!1,circuitBreakerLoading:!1,data:null},metrics:{testStarted:!1,step:0,text:[],loading:!1,stop:!1,data:!1,datasets:[]}},e}return Object(z.a)(r,[{key:"componentDidMount",value:function(){this.loadStatus()}},{key:"render",value:function(){return Object(T.jsx)(be,{name:this.props.name,collect:this.state.collect,results:this.state.results,metrics:this.state.metrics,cb:{onChangeCollect:this.onChangeCollect,onClickRetrieve:this.onClickRetrieve,onChangeCircuitBreaker:this.onChangeBreaker,startTest:this.startTest,stopTest:this.stopTest,onClickClear:this.onClickClear}})}}]),r}(n.Component);var pe=Object(i.b)((function(e){return{name:e.auth.name}}))(ge),Oe=function(e){Object(D.a)(r,e);var t=Object(q.a)(r);function r(){var e;Object(A.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).logout=function(t){sessionStorage.removeItem("auth"),e.props.dispatch(b())},e}return Object(z.a)(r,[{key:"render",value:function(){return Object(T.jsx)(Q,{loggedIn:this.props.loggedIn,logout:this.logout})}}]),r}(n.Component),xe=Object(i.b)((function(e){return{}}))(Oe),ve=function(e){e.match.params;return Object(T.jsxs)("div",{children:[Object(T.jsx)(xe,{loggedIn:!0}),Object(T.jsx)(C.a,{children:Object(T.jsx)(M.a,{children:Object(T.jsx)(G.a,{style:{padding:"2em"},children:Object(T.jsx)(pe,{})})})})]})},me=function(e){Object(D.a)(r,e);var t=Object(q.a)(r);function r(){return Object(A.a)(this,r),t.apply(this,arguments)}return Object(z.a)(r,[{key:"componentDidMount",value:function(){var e=this;this.props.dispatch(h()),re.login().then((function(t){t?(re.storeUserIfValidJWT(t),e.props.history.push("/")):(re.expireUser(),sessionStorage.setItem("error","login_failed"),e.props.history.push("/"))})).catch((function(t){if(re.expireUser(),t.response&&"All seats taken!"===t.response.data.user_message)return sessionStorage.setItem("error","seats_taken"),void e.props.history.push("/");sessionStorage.setItem("error","login_failed"),e.props.history.push("/")}))}},{key:"render",value:function(){return Object(T.jsxs)("div",{children:[Object(T.jsx)(Q,{loggedIn:!1}),Object(T.jsx)(_,{})]})}}]),r}(n.Component),ke=Object(i.b)((function(e){return{}}))(me),Se=function(e){e.match.params;var t=e.history;return Object(T.jsx)(ke,{history:t})};var ye=function(){return Object(T.jsx)(y.a,{basename:"/",children:Object(T.jsxs)(C.a,{style:{marginTop:"1em"},children:[Object(T.jsx)(w.a,{path:"/",exact:!0,component:ee(ve)}),Object(T.jsx)(w.a,{path:"/login",component:Se})]})})},we=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.c,Ce=Object(c.d)(g,we());re.initialize(Ce),re.loadApiUser(),s.a.render(Object(T.jsx)(i.a,{store:Ce,children:Object(T.jsx)(ye,{})}),document.getElementById("root"))}},[[452,1,2]]]);
//# sourceMappingURL=main.0ebbd754.chunk.js.map